# 合并 Pandas DataFrame





| 1    |      |      |
| ---- | ---- | ---- |
| 2    |      |      |
| 3    |      |      |
| 4    |      |      |
|      | A    | B    |



merge

sub

|  1   |      |      |
| :--: | :--: | :--: |
|  2   |      |      |
|  4   |      |      |
|  1   |      |      |
|      |  C   |  D   |

表格合并后，创建一个含有两个表格所有的列的新表格



| 1    |      |      |      |      |
| ---- | ---- | ---- | ---- | ---- |
| 2    |      |      |      |      |
| 3    |      |      |      |      |
| 4    |      |      |      |      |



| account_key |      |      |      |      |
| ----------- | ---- | ---- | ---- | ---- |
| 1           |      |      |      |      |
| 2           |      |      |      |      |
| 4           |      |      |      |      |
| 1           |      |      |      |      |
| 3           | 5/16 | 3    |      |      |

如果3,这一行只存在于坐标表格，但是语句中how = 'right',右边的表格没有，合并的表格中也会被保留，没有的写NaN.



和数据库中join类似。



working with Multiple DataFrames

Exercise : use merge() to combine the subway and weather data



实例：

```python
import pandas as pd

subway_df = pd.DataFrame({
    'UNIT': ['R003', 'R003', 'R003', 'R003', 'R003', 'R004', 'R004', 'R004',
             'R004', 'R004'],
    'DATEn': ['05-01-11', '05-02-11', '05-03-11', '05-04-11', '05-05-11',
              '05-01-11', '05-02-11', '05-03-11', '05-04-11', '05-05-11'],
    'hour': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    'ENTRIESn': [ 4388333,  4388348,  4389885,  4391507,  4393043, 14656120,
                 14656174, 14660126, 14664247, 14668301],
    'EXITSn': [ 2911002,  2911036,  2912127,  2913223,  2914284, 14451774,
               14451851, 14454734, 14457780, 14460818],
    'latitude': [ 40.689945,  40.689945,  40.689945,  40.689945,  40.689945,
                  40.69132 ,  40.69132 ,  40.69132 ,  40.69132 ,  40.69132 ],
    'longitude': [-73.872564, -73.872564, -73.872564, -73.872564, -73.872564,
                  -73.867135, -73.867135, -73.867135, -73.867135, -73.867135]
})
# print subway_df

weather_df = pd.DataFrame({
    'DATEn': ['05-01-11', '05-01-11', '05-02-11', '05-02-11', '05-03-11',
              '05-03-11', '05-04-11', '05-04-11', '05-05-11', '05-05-11'],
    'hour': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    'latitude': [ 40.689945,  40.69132 ,  40.689945,  40.69132 ,  40.689945,
                  40.69132 ,  40.689945,  40.69132 ,  40.689945,  40.69132 ],
    'longitude': [-73.872564, -73.867135, -73.872564, -73.867135, -73.872564,
                  -73.867135, -73.872564, -73.867135, -73.872564, -73.867135],
    'pressurei': [ 30.24,  30.24,  30.32,  30.32,  30.14,  30.14,  29.98,  29.98,
                   30.01,  30.01],
    'fog': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    'rain': [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    'tempi': [ 52. ,  52. ,  48.9,  48.9,  54. ,  54. ,  57.2,  57.2,  48.9,  48.9],
    'wspdi': [  8.1,   8.1,   6.9,   6.9,   3.5,   3.5,  15. ,  15. ,  15. ,  15. ]
})
# print weather_df
def combine_dfs(subway_df, weather_df):
    '''
    Fill in this function to take 2 DataFrames, one with subway data and one with weather data,
    and return a single dataframe with one row for each date, hour, and location. Only include
    times and locations that have both subway data and weather data available.
    '''
    return subway_df.merge(weather_df,on ='DATEn',how='outer')
    
print combine_dfs(subway_df, weather_df)
```



```python
       DATEn  ENTRIESn    EXITSn  UNIT  hour_x  latitude_x  longitude_x  fog  \
0   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
1   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
2   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
3   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
4   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
5   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
6   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
7   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
8   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
9   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
10  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
11  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
12  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
13  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
14  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
15  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
16  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
17  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
18  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   
19  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   

    hour_y  latitude_y  longitude_y  pressurei  rain  tempi  wspdi  
0        0   40.689945   -73.872564      30.24     0   52.0    8.1  
1        0   40.691320   -73.867135      30.24     0   52.0    8.1  
2        0   40.689945   -73.872564      30.24     0   52.0    8.1  
3        0   40.691320   -73.867135      30.24     0   52.0    8.1  
4        0   40.689945   -73.872564      30.32     0   48.9    6.9  
5        0   40.691320   -73.867135      30.32     0   48.9    6.9  
6        0   40.689945   -73.872564      30.32     0   48.9    6.9  
7        0   40.691320   -73.867135      30.32     0   48.9    6.9  
8        0   40.689945   -73.872564      30.14     0   54.0    3.5  
9        0   40.691320   -73.867135      30.14     0   54.0    3.5  
10       0   40.689945   -73.872564      30.14     0   54.0    3.5  
11       0   40.691320   -73.867135      30.14     0   54.0    3.5  
12       0   40.689945   -73.872564      29.98     0   57.2   15.0  
13       0   40.691320   -73.867135      29.98     0   57.2   15.0  
14       0   40.689945   -73.872564      29.98     0   57.2   15.0  
15       0   40.691320   -73.867135      29.98     0   57.2   15.0  
16       0   40.689945   -73.872564      30.01     0   48.9   15.0  
17       0   40.691320   -73.867135      30.01     0   48.9   15.0  
18       0   40.689945   -73.872564      30.01     0   48.9   15.0  
19       0   40.691320   -73.867135      30.01     0   48.9   15.0  
```



```python
# print weather_df
def combine_dfs(subway_df, weather_df):
    '''
    Fill in this function to take 2 DataFrames, one with subway data and one with weather data,
    and return a single dataframe with one row for each date, hour, and location. Only include
    times and locations that have both subway data and weather data available.
    '''
    return subway_df.merge(weather_df,on ='DATEn',how='inner') #how='inner'
    
print combine_dfs(subway_df, weather_df)
```



```python
       DATEn  ENTRIESn    EXITSn  UNIT  hour_x  latitude_x  longitude_x  fog  \
0   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
1   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
2   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
3   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
4   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
5   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
6   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
7   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
8   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
9   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
10  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
11  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
12  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
13  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
14  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
15  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
16  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
17  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
18  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   
19  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   

    hour_y  latitude_y  longitude_y  pressurei  rain  tempi  wspdi  
0        0   40.689945   -73.872564      30.24     0   52.0    8.1  
1        0   40.691320   -73.867135      30.24     0   52.0    8.1  
2        0   40.689945   -73.872564      30.24     0   52.0    8.1  
3        0   40.691320   -73.867135      30.24     0   52.0    8.1  
4        0   40.689945   -73.872564      30.32     0   48.9    6.9  
5        0   40.691320   -73.867135      30.32     0   48.9    6.9  
6        0   40.689945   -73.872564      30.32     0   48.9    6.9  
7        0   40.691320   -73.867135      30.32     0   48.9    6.9  
8        0   40.689945   -73.872564      30.14     0   54.0    3.5  
9        0   40.691320   -73.867135      30.14     0   54.0    3.5  
10       0   40.689945   -73.872564      30.14     0   54.0    3.5  
11       0   40.691320   -73.867135      30.14     0   54.0    3.5  
12       0   40.689945   -73.872564      29.98     0   57.2   15.0  
13       0   40.691320   -73.867135      29.98     0   57.2   15.0  
14       0   40.689945   -73.872564      29.98     0   57.2   15.0  
15       0   40.691320   -73.867135      29.98     0   57.2   15.0  
16       0   40.689945   -73.872564      30.01     0   48.9   15.0  
17       0   40.691320   -73.867135      30.01     0   48.9   15.0  
18       0   40.689945   -73.872564      30.01     0   48.9   15.0  
19       0   40.691320   -73.867135      30.01     0   48.9   15.0 
```



```python
def combine_dfs(subway_df, weather_df):
   
    return subway_df.merge(weather_df,on ='DATEn',how='left')
    
print combine_dfs(subway_df, weather_df)
```



```python
       DATEn  ENTRIESn    EXITSn  UNIT  hour_x  latitude_x  longitude_x  fog  \
0   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
1   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
2   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
3   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
4   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
5   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
6   05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
7   05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
8   05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
9   05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
10  05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
11  05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
12  05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
13  05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
14  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
15  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
16  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
17  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
18  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   
19  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   

    hour_y  latitude_y  longitude_y  pressurei  rain  tempi  wspdi  
0        0   40.689945   -73.872564      30.24     0   52.0    8.1  
1        0   40.691320   -73.867135      30.24     0   52.0    8.1  
2        0   40.689945   -73.872564      30.32     0   48.9    6.9  
3        0   40.691320   -73.867135      30.32     0   48.9    6.9  
4        0   40.689945   -73.872564      30.14     0   54.0    3.5  
5        0   40.691320   -73.867135      30.14     0   54.0    3.5  
6        0   40.689945   -73.872564      29.98     0   57.2   15.0  
7        0   40.691320   -73.867135      29.98     0   57.2   15.0  
8        0   40.689945   -73.872564      30.01     0   48.9   15.0  
9        0   40.691320   -73.867135      30.01     0   48.9   15.0  
10       0   40.689945   -73.872564      30.24     0   52.0    8.1  
11       0   40.691320   -73.867135      30.24     0   52.0    8.1  
12       0   40.689945   -73.872564      30.32     0   48.9    6.9  
13       0   40.691320   -73.867135      30.32     0   48.9    6.9  
14       0   40.689945   -73.872564      30.14     0   54.0    3.5  
15       0   40.691320   -73.867135      30.14     0   54.0    3.5  
16       0   40.689945   -73.872564      29.98     0   57.2   15.0  
17       0   40.691320   -73.867135      29.98     0   57.2   15.0  
18       0   40.689945   -73.872564      30.01     0   48.9   15.0  
19       0   40.691320   -73.867135      30.01     0   48.9   15.0  
```



```python

```



```python
       DATEn  ENTRIESn    EXITSn  UNIT  hour_x  latitude_x  longitude_x  fog  \
0   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
1   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
2   05-01-11   4388333   2911002  R003       0   40.689945   -73.872564    0   
3   05-01-11  14656120  14451774  R004       0   40.691320   -73.867135    0   
4   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
5   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
6   05-02-11   4388348   2911036  R003       0   40.689945   -73.872564    0   
7   05-02-11  14656174  14451851  R004       0   40.691320   -73.867135    0   
8   05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
9   05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
10  05-03-11   4389885   2912127  R003       0   40.689945   -73.872564    0   
11  05-03-11  14660126  14454734  R004       0   40.691320   -73.867135    0   
12  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
13  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
14  05-04-11   4391507   2913223  R003       0   40.689945   -73.872564    0   
15  05-04-11  14664247  14457780  R004       0   40.691320   -73.867135    0   
16  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
17  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   
18  05-05-11   4393043   2914284  R003       0   40.689945   -73.872564    0   
19  05-05-11  14668301  14460818  R004       0   40.691320   -73.867135    0   

    hour_y  latitude_y  longitude_y  pressurei  rain  tempi  wspdi  
0        0   40.689945   -73.872564      30.24     0   52.0    8.1  
1        0   40.689945   -73.872564      30.24     0   52.0    8.1  
2        0   40.691320   -73.867135      30.24     0   52.0    8.1  
3        0   40.691320   -73.867135      30.24     0   52.0    8.1  
4        0   40.689945   -73.872564      30.32     0   48.9    6.9  
5        0   40.689945   -73.872564      30.32     0   48.9    6.9  
6        0   40.691320   -73.867135      30.32     0   48.9    6.9  
7        0   40.691320   -73.867135      30.32     0   48.9    6.9  
8        0   40.689945   -73.872564      30.14     0   54.0    3.5  
9        0   40.689945   -73.872564      30.14     0   54.0    3.5  
10       0   40.691320   -73.867135      30.14     0   54.0    3.5  
11       0   40.691320   -73.867135      30.14     0   54.0    3.5  
12       0   40.689945   -73.872564      29.98     0   57.2   15.0  
13       0   40.689945   -73.872564      29.98     0   57.2   15.0  
14       0   40.691320   -73.867135      29.98     0   57.2   15.0  
15       0   40.691320   -73.867135      29.98     0   57.2   15.0  
16       0   40.689945   -73.872564      30.01     0   48.9   15.0  
17       0   40.689945   -73.872564      30.01     0   48.9   15.0  
18       0   40.691320   -73.867135      30.01     0   48.9   15.0  
19       0   40.691320   -73.867135      30.01     0   48.9   15.0  
```

